<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MPD Testing</title>
    <style>
        img {
            position: absolute;
            left: 0px;
            top: 0px;
            z-index: -1;
        }
        /*@font-face { font-family: Viper; src: url('fonts/ViperDisplay-Bold.ttf');}*/
        /*input {*/
        /*    font-family: Viper,serif;*/
        /*}*/

        @font-face { font-family: Apache; src: url('fonts/AH-64D.ttf');}
        input {
            font-family: Apache, serif;
        }
    </style>
    <script src="js/Drawing_Functions.js"></script>
    <script src="js/mpd_screen.js"></script>
    <script src="js/button_profiles/TSD_Buttons.js"></script>
    <script src="js/button_profiles/TSD_POINT_Buttons.js"></script>
    <script src="js/button_profiles/MAP_Buttons.js"></script>
    <script src="js/button_profiles/SHOW_Buttons.js"></script>
    <script>
        let currentPage = "TSD_POINT";
        let lastButton = null;
        
        function getMousePos(canvas, event) {
            let rect = canvas.getBoundingClientRect();
            return {
                x: event.clientX - rect.left,
                y: event.clientY - rect.top
            };
        }

        // Function to check whether a point is inside a rectangle
        function isInside(pos, rect) {
            return pos.x > rect.x && pos.x < rect.x + rect.width && pos.y < rect.y + rect.height && pos.y > rect.y
        }
    </script>
    <script src="js/Process_Data.js"></script>
</head>
<body onload="init_screen()">
<div style="display: none;">
    <img id="map_chart" src="img/map_chart.png" height="606" width="571"/>
    <img id="map_sat" src="img/map_sat.png" height="608" width="564"/>
    <img id="map_dig" src="img/map_dig.png" height="603" width="564"/>
    <img id="map_dig_ac" src="img/dig_ac.png" height="607" width="567"/>
    <img id="map_dig_elev" src="img/dig_elev.png" height="607" width="565"/>
    <img id="ownship" src="img/TSD_Ownship.svg"/>
    <img id="compassrose" src="img/TSD_CompassRose.svg"/>
</div>
<canvas id="mpd" width="880" height="860" style="background: #2e2e2e;"></canvas>
<div>
    <input id="KU" type="text" style="border: none; background: black; color: #06dd0d; height: 30px; width: 880px; font-size: 20px;"/>
</div>
</body>
<script>
    const c = document.getElementById("mpd");
    const ctx = c.getContext("2d");
    const TSD_ownship = document.getElementById("ownship");
    const TSD_compassrose = document.getElementById("compassrose");
    const KU = document.getElementById("KU");
    const map_chart = document.getElementById("map_chart");
    const map_dig = document.getElementById("map_dig");
    const map_dig_ac = document.getElementById("map_dig_ac");
    const map_dig_elev = document.getElementById("map_dig_elev");
    const map_sat = document.getElementById("map_sat");
    
    const specialButtons = {TSD: null, COM: null, FCR: null, VID: null, AC: null, WPN: null, B1: "M"};
    for (let button in mpdButtons) { // Draw buttons
        if (typeof specialButtons[button] !== "undefined") {
            const text = (button === "AC" ? "A/C" : (button === "B1" ? "M" : button));
            ctx.fillStyle = "#141414"; // Button color
            ctx.fillRect(mpdButtons[button].x, mpdButtons[button].y, mpdButtons[button].width, mpdButtons[button].height);
            ctx.fillStyle = "#fff";
            ctx.font = "30px Monospace, Monospace";
            const textHeight = ctx.measureText(text).actualBoundingBoxAscent;
            const textWidth = ctx.measureText(text).width;
            ctx.fillText(text, mpdButtons[button].x + ((mpdButtons[button].width - textWidth) / 2), mpdButtons[button].y + (40 - textHeight / 2));
        } else {
            ctx.fillStyle = "#889bab"; // Button color
            ctx.fillRect(mpdButtons[button].x, mpdButtons[button].y, mpdButtons[button].width, mpdButtons[button].height);
            ctx.fillStyle = "#fff"; // Button circle color
            ctx.beginPath();
            ctx.arc(mpdButtons[button].x + 20, mpdButtons[button].y + 20, 5, 0, 2 * Math.PI);
            ctx.fill();
        }
    }

    // Draw button lines T1 thru T6
    for (let i = 1; i <= 6; i++) {
        ctx.beginPath();
        ctx.strokeStyle = "white";
        ctx.lineWidth = 2;
        ctx.moveTo(mpdButtons["T" + i.toString()].x + 20, mpdButtons["T" + i.toString()].y + 42);
        ctx.lineTo(mpdButtons["T" + i.toString()].x + 20, screen.y);
        ctx.stroke();
    }

    // Draw button lines L1 thru L6
    for (let i = 1; i <= 6; i++) {
        ctx.beginPath();
        ctx.strokeStyle = "white";
        ctx.lineWidth = 2;
        ctx.moveTo(mpdButtons["L" + i.toString()].x + 42, mpdButtons["L" + i.toString()].y + 20);
        ctx.lineTo(screen.x, mpdButtons["L" + i.toString()].y + 20);
        ctx.stroke();
    }

    // Draw button lines R1 thru R6
    for (let i = 1; i <= 6; i++) {
        ctx.beginPath();
        ctx.strokeStyle = "white";
        ctx.lineWidth = 2;
        ctx.moveTo(mpdButtons["R" + i.toString()].x - 2, mpdButtons["R" + i.toString()].y + 20);
        ctx.lineTo(screen.x + screen.w, mpdButtons["R" + i.toString()].y + 20);
        ctx.stroke();
    }

    // Draw button lines B1 thru B6
    for (let i = 1; i <= 6; i++) {
        ctx.beginPath();
        ctx.strokeStyle = "white";
        ctx.lineWidth = 2;
        ctx.moveTo(mpdButtons["B" + i.toString()].x + 20, mpdButtons["B" + i.toString()].y - 2);
        ctx.lineTo(mpdButtons["B" + i.toString()].x + 20, screen.y + screen.h);
        ctx.stroke();
    }
    
    document.getElementById("KU").addEventListener('keyup', function (evt) {
        // console.log(evt.key);
        Draw_User_Input_Dialog();
        if (evt.key === "Enter") {
            Process_Data();
        }
    });
    
    c.addEventListener('click', function(evt) { // Listen for button clicks
        let mousePos = getMousePos(c, evt);
        
        for (let button in mpdButtons) {
            if (isInside(mousePos, mpdButtons[button])) {
                button_commands[button]();
                lastButton = button;
            }
        }
        
        if (inputReady) {
            if (isInside(mousePos, {x: screen.x + (screen.w / 2) / 2, y: screen.y + (screen.h / 2) - 20, width: screen.w / 2, height: 40})) {
                KU.focus();
            }
        }
    }, false);

    function init_screen(){
        Draw_Screen_Background();
        Load_Page(currentPage);
    }
</script>
</html>